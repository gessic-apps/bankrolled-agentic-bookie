<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Betting Markets API - Test UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 800px;
            margin-top: 40px;
        }
        .endpoint-card {
            margin-bottom: 20px;
        }
        .response-area {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .form-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">NBA Betting Markets API - Test UI</h1>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Deploy Market Factory</h5>
                <span class="badge bg-primary">POST /api/deploy/factory</span>
            </div>
            <div class="card-body">
                <form id="deployFactoryForm">
                    <div class="mb-3">
                        <label for="oddsProviderAddress" class="form-label">Odds Provider Address</label>
                        <input type="text" class="form-control" id="oddsProviderAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="resultsProviderAddress" class="form-label">Results Provider Address</label>
                        <input type="text" class="form-control" id="resultsProviderAddress" placeholder="0x...">
                    </div>
                    <button type="submit" class="btn btn-primary">Deploy</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="deployFactoryResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Create Market</h5>
                <span class="badge bg-primary">POST /api/market/create</span>
            </div>
            <div class="card-body">
                <form id="createMarketForm">
                    <div class="mb-3">
                        <label for="homeTeam" class="form-label">Home Team</label>
                        <input type="text" class="form-control" id="homeTeam" placeholder="Lakers">
                    </div>
                    <div class="mb-3">
                        <label for="awayTeam" class="form-label">Away Team</label>
                        <input type="text" class="form-control" id="awayTeam" placeholder="Celtics">
                    </div>
                    <div class="mb-3">
                        <label for="gameTimestamp" class="form-label">Game Timestamp</label>
                        <input type="number" class="form-control" id="gameTimestamp" placeholder="Unix timestamp (seconds)">
                    </div>
                    <div class="mb-3">
                        <label for="homeOdds" class="form-label">Home Odds (optional)</label>
                        <input type="number" class="form-control" id="homeOdds" placeholder="e.g. 1850 for 1.85 odds">
                    </div>
                    <div class="mb-3">
                        <label for="awayOdds" class="form-label">Away Odds (optional)</label>
                        <input type="number" class="form-control" id="awayOdds" placeholder="e.g. 2000 for 2.00 odds">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Market</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="createMarketResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Update Odds</h5>
                <span class="badge bg-primary">POST /api/market/:address/update-odds</span>
            </div>
            <div class="card-body">
                <form id="updateOddsForm">
                    <div class="mb-3">
                        <label for="marketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="marketAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="updateHomeOdds" class="form-label">Home Odds</label>
                        <input type="number" class="form-control" id="updateHomeOdds" placeholder="e.g. 1941 for 1.941 odds">
                    </div>
                    <div class="mb-3">
                        <label for="updateAwayOdds" class="form-label">Away Odds</label>
                        <input type="number" class="form-control" id="updateAwayOdds" placeholder="e.g. 1051 for 1.051 odds">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Odds</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="updateOddsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get All Markets</h5>
                <span class="badge bg-primary">GET /api/markets</span>
            </div>
            <div class="card-body">
                <button id="getMarketsBtn" class="btn btn-primary">Fetch Markets</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="getMarketsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get Market Info</h5>
                <span class="badge bg-primary">GET /api/market/:address</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="getMarketAddress" class="form-label">Market Address</label>
                    <input type="text" class="form-control" id="getMarketAddress" placeholder="0x...">
                </div>
                <button id="getMarketInfoBtn" class="btn btn-primary">Get Info</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="getMarketInfoResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Transaction Explorer</h5>
                <span class="badge bg-primary">GET /api/tx/:txHash</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="txHash" class="form-label">Transaction Hash</label>
                    <input type="text" class="form-control" id="txHash" placeholder="0x...">
                </div>
                <button id="getTxDetailsBtn" class="btn btn-primary">View Transaction</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="txDetailsResponse"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = window.location.origin;
        
        document.getElementById('deployFactoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const oddsProviderAddress = document.getElementById('oddsProviderAddress').value;
            const resultsProviderAddress = document.getElementById('resultsProviderAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/deploy/factory`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        oddsProviderAddress,
                        resultsProviderAddress
                    }),
                });
                
                const data = await response.json();
                document.getElementById('deployFactoryResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('deployFactoryResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('createMarketForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const gameTimestamp = document.getElementById('gameTimestamp').value;
            const homeOdds = document.getElementById('homeOdds').value;
            const awayOdds = document.getElementById('awayOdds').value;
            
            const payload = {
                homeTeam,
                awayTeam,
                gameTimestamp: parseInt(gameTimestamp)
            };
            
            if (homeOdds && awayOdds) {
                payload.homeOdds = parseInt(homeOdds);
                payload.awayOdds = parseInt(awayOdds);
            }
            
            try {
                const response = await fetch(`${API_URL}/api/market/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });
                
                const data = await response.json();
                document.getElementById('createMarketResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.market && data.market.address) {
                    // Auto-fill the market address for other forms
                    document.getElementById('marketAddress').value = data.market.address;
                    document.getElementById('getMarketAddress').value = data.market.address;
                }
            } catch (error) {
                document.getElementById('createMarketResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('updateOddsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('marketAddress').value;
            const homeOdds = document.getElementById('updateHomeOdds').value;
            const awayOdds = document.getElementById('updateAwayOdds').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/update-odds`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        homeOdds: parseInt(homeOdds),
                        awayOdds: parseInt(awayOdds)
                    }),
                });
                
                const data = await response.json();
                document.getElementById('updateOddsResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('updateOddsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getMarketsBtn').addEventListener('click', async () => {
            try {
                const response = await fetch(`${API_URL}/api/markets`);
                const data = await response.json();
                document.getElementById('getMarketsResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('getMarketsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getMarketInfoBtn').addEventListener('click', async () => {
            const marketAddress = document.getElementById('getMarketAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}`);
                const data = await response.json();
                document.getElementById('getMarketInfoResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('getMarketInfoResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getTxDetailsBtn').addEventListener('click', async () => {
            const txHash = document.getElementById('txHash').value;
            
            try {
                const response = await fetch(`${API_URL}/api/tx/${txHash}`);
                const data = await response.json();
                document.getElementById('txDetailsResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('txDetailsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        // Auto-fill transaction hash when available from other operations
        const updateTxHash = (hash) => {
            if (hash) {
                document.getElementById('txHash').value = hash;
            }
        };
        
        // Helper function to parse and store transaction hash
        const handleResponse = (responseElement, data) => {
            responseElement.textContent = JSON.stringify(data, null, 2);
            if (data.transaction) {
                updateTxHash(data.transaction);
            }
        };
        
        // Update existing event listeners to store transaction hashes
        const originalDeployFactoryFormHandler = document.getElementById('deployFactoryForm').onsubmit;
        document.getElementById('deployFactoryForm').onsubmit = async (e) => {
            e.preventDefault();
            const oddsProviderAddress = document.getElementById('oddsProviderAddress').value;
            const resultsProviderAddress = document.getElementById('resultsProviderAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/deploy/factory`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ oddsProviderAddress, resultsProviderAddress }),
                });
                
                const data = await response.json();
                handleResponse(document.getElementById('deployFactoryResponse'), data);
            } catch (error) {
                document.getElementById('deployFactoryResponse').textContent = `Error: ${error.message}`;
            }
        };
        
        const originalCreateMarketFormHandler = document.getElementById('createMarketForm').onsubmit;
        document.getElementById('createMarketForm').onsubmit = async (e) => {
            e.preventDefault();
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const gameTimestamp = document.getElementById('gameTimestamp').value;
            const homeOdds = document.getElementById('homeOdds').value;
            const awayOdds = document.getElementById('awayOdds').value;
            
            const payload = {
                homeTeam,
                awayTeam,
                gameTimestamp: parseInt(gameTimestamp)
            };
            
            if (homeOdds && awayOdds) {
                payload.homeOdds = parseInt(homeOdds);
                payload.awayOdds = parseInt(awayOdds);
            }
            
            try {
                const response = await fetch(`${API_URL}/api/market/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                
                const data = await response.json();
                handleResponse(document.getElementById('createMarketResponse'), data);
                
                if (data.market && data.market.address) {
                    document.getElementById('marketAddress').value = data.market.address;
                    document.getElementById('getMarketAddress').value = data.market.address;
                }
            } catch (error) {
                document.getElementById('createMarketResponse').textContent = `Error: ${error.message}`;
            }
        };
        
        const originalUpdateOddsFormHandler = document.getElementById('updateOddsForm').onsubmit;
        document.getElementById('updateOddsForm').onsubmit = async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('marketAddress').value;
            const homeOdds = document.getElementById('updateHomeOdds').value;
            const awayOdds = document.getElementById('updateAwayOdds').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/update-odds`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        homeOdds: parseInt(homeOdds),
                        awayOdds: parseInt(awayOdds)
                    }),
                });
                
                const data = await response.json();
                handleResponse(document.getElementById('updateOddsResponse'), data);
            } catch (error) {
                document.getElementById('updateOddsResponse').textContent = `Error: ${error.message}`;
            }
        };
        
        // Auto-fill timestamps with a value 24 hours in the future
        document.getElementById('gameTimestamp').value = Math.floor(Date.now() / 1000) + 86400;
        
        // Pre-fill Hardhat default addresses for convenience during local testing
        document.getElementById('oddsProviderAddress').value = '0x70997970C51812dc3A010C7d01b50e0d17dc79C8';
        document.getElementById('resultsProviderAddress').value = '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC';
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>