<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Betting Markets API - Test UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 800px;
            margin-top: 40px;
        }
        .endpoint-card {
            margin-bottom: 20px;
        }
        .response-area {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .form-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">NBA Betting Markets API - Test UI</h1>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Deploy Market Factory</h5>
                <span class="badge bg-primary">POST /api/deploy/factory</span>
            </div>
            <div class="card-body">
                <form id="deployFactoryForm">
                    <div class="mb-3">
                        <label for="oddsProviderAddress" class="form-label">Odds Provider Address</label>
                        <input type="text" class="form-control" id="oddsProviderAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="resultsProviderAddress" class="form-label">Results Provider Address</label>
                        <input type="text" class="form-control" id="resultsProviderAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="usdxAddress" class="form-label">USDX Token Address</label>
                        <input type="text" class="form-control" id="usdxAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="liquidityPoolAddress" class="form-label">Liquidity Pool Address</label>
                        <input type="text" class="form-control" id="liquidityPoolAddress" placeholder="0x...">
                    </div>
                    <button type="submit" class="btn btn-primary">Deploy</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="deployFactoryResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Create Market</h5>
                <span class="badge bg-primary">POST /api/market/create</span>
            </div>
            <div class="card-body">
                <form id="createMarketForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="homeTeam" class="form-label">Home Team</label>
                            <input type="text" class="form-control" id="homeTeam" placeholder="Lakers">
                        </div>
                        <div class="col-md-6">
                            <label for="awayTeam" class="form-label">Away Team</label>
                            <input type="text" class="form-control" id="awayTeam" placeholder="Celtics">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="gameTimestamp" class="form-label">Game Timestamp</label>
                            <input type="number" class="form-control" id="gameTimestamp" placeholder="Unix timestamp (seconds)">
                        </div>
                        <div class="col-md-6">
                            <label for="oddsApiId" class="form-label">Odds API ID</label>
                            <input type="text" class="form-control" id="oddsApiId" placeholder="NBA_LAL_BOS_20230405">
                        </div>
                    </div>
                     <hr/>
                    <h6 class="mb-3">Initial Odds & Lines (Optional)</h6>
                     <div class="row mb-2">
                         <div class="col-md-4">
                            <label for="homeOdds" class="form-label">Home ML Odds</label>
                            <input type="number" class="form-control" id="homeOdds" placeholder="e.g. 1850 (1.85)">
                        </div>
                        <div class="col-md-4">
                            <label for="awayOdds" class="form-label">Away ML Odds</label>
                            <input type="number" class="form-control" id="awayOdds" placeholder="e.g. 2000 (2.00)">
                        </div>
                        <div class="col-md-4">
                            <label for="drawOdds" class="form-label">Draw Odds (Soccer)</label>
                            <input type="number" class="form-control" id="drawOdds" placeholder="e.g. 3000 (3.00)">
                        </div>
                    </div>
                    <div class="row mb-2">
                         <div class="col-md-4">
                            <label for="homeSpreadPoints" class="form-label">Home Spread</label>
                            <input type="number" step="5" class="form-control" id="homeSpreadPoints" placeholder="e.g. -75 (-7.5)">
                        </div>
                        <div class="col-md-4">
                            <label for="homeSpreadOdds" class="form-label">Home Spread Odds</label>
                            <input type="number" class="form-control" id="homeSpreadOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                        <div class="col-md-4">
                            <label for="awaySpreadOdds" class="form-label">Away Spread Odds</label>
                            <input type="number" class="form-control" id="awaySpreadOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                    </div>
                     <div class="row mb-3">
                         <div class="col-md-4">
                            <label for="totalPoints" class="form-label">Total Points</label>
                            <input type="number" step="5" class="form-control" id="totalPoints" placeholder="e.g. 2105 (210.5)">
                        </div>
                        <div class="col-md-4">
                            <label for="overOdds" class="form-label">Over Odds</label>
                            <input type="number" class="form-control" id="overOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                        <div class="col-md-4">
                            <label for="underOdds" class="form-label">Under Odds</label>
                            <input type="number" class="form-control" id="underOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                    </div>
                    <hr/>
                    <div class="mb-3">
                        <label for="marketFunding" class="form-label">Market Funding (USDX)</label>
                        <input type="number" class="form-control" id="marketFunding" placeholder="e.g. 50000 (Default: 100k)">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Market</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="createMarketResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Update Odds</h5>
                <span class="badge bg-primary">POST /api/market/:address/update-odds</span>
            </div>
            <div class="card-body">
                <form id="updateOddsForm">
                    <div class="mb-3">
                        <label for="marketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="marketAddress" placeholder="0x...">
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <label for="updateHomeOdds" class="form-label">Home ML Odds</label>
                            <input type="number" class="form-control" id="updateHomeOdds" placeholder="e.g. 1941 (1.941)">
                        </div>
                         <div class="col-md-4">
                            <label for="updateAwayOdds" class="form-label">Away ML Odds</label>
                            <input type="number" class="form-control" id="updateAwayOdds" placeholder="e.g. 1051 (1.051)">
                        </div>
                         <div class="col-md-4">
                            <label for="updateDrawOdds" class="form-label">Draw Odds (Soccer)</label>
                            <input type="number" class="form-control" id="updateDrawOdds" placeholder="e.g. 3000 (3.00)">
                        </div>
                    </div>
                     <div class="row mb-2">
                         <div class="col-md-4">
                            <label for="updateHomeSpreadPoints" class="form-label">Home Spread</label>
                            <input type="number" step="5" class="form-control" id="updateHomeSpreadPoints" placeholder="e.g. -75 (-7.5)">
                        </div>
                        <div class="col-md-4">
                            <label for="updateHomeSpreadOdds" class="form-label">Home Spread Odds</label>
                            <input type="number" class="form-control" id="updateHomeSpreadOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                        <div class="col-md-4">
                            <label for="updateAwaySpreadOdds" class="form-label">Away Spread Odds</label>
                            <input type="number" class="form-control" id="updateAwaySpreadOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                    </div>
                     <div class="row mb-3">
                         <div class="col-md-4">
                            <label for="updateTotalPoints" class="form-label">Total Points</label>
                            <input type="number" step="5" class="form-control" id="updateTotalPoints" placeholder="e.g. 2105 (210.5)">
                        </div>
                        <div class="col-md-4">
                            <label for="updateOverOdds" class="form-label">Over Odds</label>
                            <input type="number" class="form-control" id="updateOverOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                        <div class="col-md-4">
                            <label for="updateUnderOdds" class="form-label">Under Odds</label>
                            <input type="number" class="form-control" id="updateUnderOdds" placeholder="e.g. 1910 (1.91)">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Update Odds</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="updateOddsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Add Liquidity to Market</h5>
                <span class="badge bg-primary">POST /api/market/:address/add-liquidity</span>
            </div>
            <div class="card-body">
                <form id="addLiquidityForm">
                    <div class="mb-3">
                        <label for="liquidityMarketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="liquidityMarketAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="liquidityAmount" class="form-label">Amount (USDX)</label>
                        <input type="number" class="form-control" id="liquidityAmount" placeholder="e.g. 10000" min="1">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Liquidity</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="addLiquidityResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">USDX Faucet</h5>
                <span class="badge bg-primary">POST /api/faucet</span>
            </div>
            <div class="card-body">
                <form id="faucetForm">
                    <div class="mb-3">
                        <label for="faucetAddress" class="form-label">Wallet Address</label>
                        <select class="form-select" id="faucetAddress">
                            <option value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">Account 1 (0x7099...79C8)</option>
                            <option value="0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC">Account 2 (0x3C44...93BC)</option>
                            <option value="0x90F79bf6EB2c4f870365E785982E1f101E93b906">Account 3 (0x90F7...b906)</option>
                            <option value="0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65">Account 4 (0x15d3...6A65)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="faucetAmount" class="form-label">Amount (USDX)</label>
                        <input type="number" class="form-control" id="faucetAmount" placeholder="e.g. 10000" value="10000" min="1">
                    </div>
                    <button type="submit" class="btn btn-success">Get USDX Tokens</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="faucetResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Approve USDX Spending</h5>
                <span class="badge bg-primary">POST /api/approve/:marketAddress</span>
            </div>
            <div class="card-body">
                <form id="approveForm">
                    <div class="mb-3">
                        <label for="approveMarketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="approveMarketAddress" placeholder="0x...">
                    </div>
                    <div class="mb-3">
                        <label for="approveAddress" class="form-label">Wallet Address</label>
                        <select class="form-select" id="approveAddress">
                            <option value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">Account 1 (0x7099...79C8)</option>
                            <option value="0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC">Account 2 (0x3C44...93BC)</option>
                            <option value="0x90F79bf6EB2c4f870365E785982E1f101E93b906">Account 3 (0x90F7...b906)</option>
                            <option value="0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65">Account 4 (0x15d3...6A65)</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="unlimitedApproval" checked>
                        <label class="form-check-label" for="unlimitedApproval">Unlimited Approval</label>
                    </div>
                    <button type="submit" class="btn btn-warning">Approve Spending</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="approveResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Place Bet</h5>
                <span class="badge bg-primary">POST /api/market/:address/place-bet</span>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <strong>Important:</strong> Before placing a bet, make sure to:
                    <ol class="mb-0">
                        <li>Get USDX tokens using the faucet</li>
                        <li>Approve the market to spend your tokens</li>
                    </ol>
                </div>
                <form id="placeBetForm">
                    <div class="mb-3">
                        <label for="betMarketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="betMarketAddress" placeholder="0x...">
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="betAmount" class="form-label">Amount (USDX)</label>
                            <input type="number" class="form-control" id="betAmount" placeholder="e.g. 100" min="1">
                        </div>
                        <div class="col-md-6">
                            <label for="betType" class="form-label">Bet Type</label>
                            <select class="form-select" id="betType">
                                <option value="moneyline">Moneyline</option>
                                <option value="spread">Spread</option>
                                <option value="total">Total Points</option>
                                <option value="draw">Draw (Soccer)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="betSide" class="form-label">Bet Side</label>
                            <select class="form-select" id="betSide">
                                <!-- Options dynamically updated by JS -->
                                <option value="home">Home Team</option> 
                                <option value="away">Away Team</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="bettor" class="form-label">Bettor Address</label>
                            <select class="form-select" id="bettor">
                                <option value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">Account 1 (0x7099...79C8)</option>
                                <option value="0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC">Account 2 (0x3C44...93BC)</option>
                                <option value="0x90F79bf6EB2c4f870365E785982E1f101E93b906">Account 3 (0x90F7...b906)</option>
                                <option value="0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65">Account 4 (0x15d3...6A65)</option>
                                <option value="0xdc63788Ada727255db07819632488d2629139CE8">Account 5 (0xdc6378...139CE8)</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Place Bet</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="placeBetResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Set Game Result</h5>
                <span class="badge bg-primary">POST /api/market/:address/game-status</span>
            </div>
            <div class="card-body">
                <form id="setResultForm">
                    <div class="mb-3">
                        <label for="resultMarketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="resultMarketAddress" placeholder="0x...">
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="homeScore" class="form-label">Home Score</label>
                            <input type="number" class="form-control" id="homeScore" placeholder="e.g. 110" min="0">
                        </div>
                         <div class="col-md-6">
                            <label for="awayScore" class="form-label">Away Score</label>
                            <input type="number" class="form-control" id="awayScore" placeholder="e.g. 105" min="0">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Set Result</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="setResultResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Start Game</h5>
                <span class="badge bg-primary">POST /api/market/:address/game-status</span>
            </div>
            <div class="card-body">
                <form id="startGameForm">
                    <div class="mb-3">
                        <label for="startGameMarketAddress" class="form-label">Market Address</label>
                        <input type="text" class="form-control" id="startGameMarketAddress" placeholder="0x...">
                    </div>
                    <button type="submit" class="btn btn-primary">Start Game</button>
                </form>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="startGameResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get User Bets</h5>
                <span class="badge bg-primary">GET /api/market/:address/bets/:bettor</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="userBetsMarketAddress" class="form-label">Market Address</label>
                    <input type="text" class="form-control" id="userBetsMarketAddress" placeholder="0x...">
                </div>
                <div class="mb-3">
                    <label for="userBetsBettor" class="form-label">Bettor Address</label>
                    <select class="form-select" id="userBetsBettor">
                        <option value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">Account 1 (0x7099...79C8)</option>
                        <option value="0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC">Account 2 (0x3C44...93BC)</option>
                        <option value="0x90F79bf6EB2c4f870365E785982E1f101E93b906">Account 3 (0x90F7...b906)</option>
                        <option value="0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65">Account 4 (0x15d3...6A65)</option>
                        <option value="0xdc63788Ada727255db07819632488d2629139CE8">Account 4 (0xd...39CE8)</option>
                    </select>
                </div>
                <button id="getUserBetsBtn" class="btn btn-primary">Get User Bets</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="userBetsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get Liquidity Pool Info</h5>
                <span class="badge bg-primary">GET /api/liquidity-pool</span>
            </div>
            <div class="card-body">
                <button id="getLiquidityPoolBtn" class="btn btn-primary">Get Liquidity Pool Info</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="getLiquidityPoolResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get All Markets</h5>
                <span class="badge bg-primary">GET /api/markets</span>
            </div>
            <div class="card-body">
                <button id="getMarketsBtn" class="btn btn-primary">Fetch Markets</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="getMarketsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Get Market Info</h5>
                <span class="badge bg-primary">GET /api/market/:address</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="getMarketAddress" class="form-label">Market Address</label>
                    <input type="text" class="form-control" id="getMarketAddress" placeholder="0x...">
                </div>
                <button id="getMarketInfoBtn" class="btn btn-primary">Get Info</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="getMarketInfoResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Transaction Explorer</h5>
                <span class="badge bg-primary">GET /api/tx/:txHash</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="txHash" class="form-label">Transaction Hash</label>
                    <input type="text" class="form-control" id="txHash" placeholder="0x...">
                </div>
                <button id="getTxDetailsBtn" class="btn btn-primary">View Transaction</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="txDetailsResponse"></div>
                </div>
            </div>
        </div>
        
        <div class="card endpoint-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Check Balance</h5>
                <span class="badge bg-primary">GET /api/balance/:address</span>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="balanceAddress" class="form-label">Wallet Address</label>
                    <input type="text" class="form-control" id="balanceAddress" placeholder="Enter Wallet Address 0x...">
                </div>
                <button id="getBalanceBtn" class="btn btn-info">Check Balance</button>
                <div class="mt-3">
                    <h6>Response:</h6>
                    <div class="response-area" id="balanceResponse"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = window.location.origin;
        
        // --- Helper to update Bet Side options based on Bet Type ---
        const updateBetSideOptions = () => {
            const betTypeSelect = document.getElementById('betType');
            const betSideSelect = document.getElementById('betSide');
            const selectedType = betTypeSelect.value;

            betSideSelect.innerHTML = ''; // Clear existing options

            if (selectedType === 'moneyline' || selectedType === 'spread') {
                betSideSelect.add(new Option('Home Team', 'home'));
                betSideSelect.add(new Option('Away Team', 'away'));
            } else if (selectedType === 'total') {
                betSideSelect.add(new Option('Over', 'over'));
                betSideSelect.add(new Option('Under', 'under'));
            } else if (selectedType === 'draw') {
                betSideSelect.add(new Option('Draw', 'draw'));
                // Draw bet type only needs one option as the side doesn't matter
            }
        };

        // Add event listener to Bet Type dropdown
        document.getElementById('betType').addEventListener('change', updateBetSideOptions);

        // Initial call to set options correctly on page load
        updateBetSideOptions();

        document.getElementById('deployFactoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const oddsProviderAddress = document.getElementById('oddsProviderAddress').value;
            const resultsProviderAddress = document.getElementById('resultsProviderAddress').value;
            const usdxAddress = document.getElementById('usdxAddress').value;
            const liquidityPoolAddress = document.getElementById('liquidityPoolAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/deploy/factory`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        oddsProviderAddress,
                        resultsProviderAddress,
                        usdxAddress,
                        liquidityPoolAddress
                    }),
                });
                
                const data = await response.json();
                document.getElementById('deployFactoryResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('deployFactoryResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('createMarketForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const gameTimestamp = document.getElementById('gameTimestamp').value;
            const oddsApiId = document.getElementById('oddsApiId').value;
            // Get all odds/lines values
            const homeOdds = document.getElementById('homeOdds').value || undefined;
            const awayOdds = document.getElementById('awayOdds').value || undefined;
            const homeSpreadPoints = document.getElementById('homeSpreadPoints').value || undefined;
            const homeSpreadOdds = document.getElementById('homeSpreadOdds').value || undefined;
            const awaySpreadOdds = document.getElementById('awaySpreadOdds').value || undefined;
            const totalPoints = document.getElementById('totalPoints').value || undefined;
            const overOdds = document.getElementById('overOdds').value || undefined;
            const underOdds = document.getElementById('underOdds').value || undefined;
            const marketFunding = document.getElementById('marketFunding').value;
            
            const payload = {
                homeTeam,
                awayTeam,
                gameTimestamp: parseInt(gameTimestamp),
                oddsApiId
            };
            
            // Add odds/lines to payload only if they have values
            if (homeOdds) payload.homeOdds = parseInt(homeOdds);
            if (awayOdds) payload.awayOdds = parseInt(awayOdds);
            const drawOdds = document.getElementById('drawOdds').value;
            if (drawOdds) payload.drawOdds = parseInt(drawOdds);
            if (homeSpreadPoints) payload.homeSpreadPoints = parseInt(homeSpreadPoints);
            if (homeSpreadOdds) payload.homeSpreadOdds = parseInt(homeSpreadOdds);
            if (awaySpreadOdds) payload.awaySpreadOdds = parseInt(awaySpreadOdds);
            if (totalPoints) payload.totalPoints = parseInt(totalPoints);
            if (overOdds) payload.overOdds = parseInt(overOdds);
            if (underOdds) payload.underOdds = parseInt(underOdds);
            
            if (marketFunding) {
                payload.marketFunding = parseFloat(marketFunding);
            }
            
            try {
                const response = await fetch(`${API_URL}/api/market/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });
                
                const data = await response.json();
                document.getElementById('createMarketResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.market && data.market.address) {
                    // Auto-fill the market address for other forms
                    document.getElementById('marketAddress').value = data.market.address;
                    document.getElementById('liquidityMarketAddress').value = data.market.address;
                    document.getElementById('getMarketAddress').value = data.market.address;
                    document.getElementById('betMarketAddress').value = data.market.address;
                    document.getElementById('resultMarketAddress').value = data.market.address;
                    document.getElementById('startGameMarketAddress').value = data.market.address;
                    document.getElementById('userBetsMarketAddress').value = data.market.address;
                }
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('createMarketResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('updateOddsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('marketAddress').value;
            const homeOdds = document.getElementById('updateHomeOdds').value;
            const awayOdds = document.getElementById('updateAwayOdds').value;
            const homeSpreadPoints = document.getElementById('updateHomeSpreadPoints').value;
            const homeSpreadOdds = document.getElementById('updateHomeSpreadOdds').value;
            const awaySpreadOdds = document.getElementById('updateAwaySpreadOdds').value;
            const totalPoints = document.getElementById('updateTotalPoints').value;
            const overOdds = document.getElementById('updateOverOdds').value;
            const underOdds = document.getElementById('updateUnderOdds').value;
            
            // Construct payload with all fields
            const payload = {
                homeOdds: parseInt(homeOdds),
                awayOdds: parseInt(awayOdds),
                drawOdds: parseInt(document.getElementById('updateDrawOdds').value || '0'),
                homeSpreadPoints: parseInt(homeSpreadPoints),
                homeSpreadOdds: parseInt(homeSpreadOdds),
                awaySpreadOdds: parseInt(awaySpreadOdds),
                totalPoints: parseInt(totalPoints),
                overOdds: parseInt(overOdds),
                underOdds: parseInt(underOdds)
            };

            // Basic validation (ensure required fields are numbers)
            if (Object.values(payload).some(isNaN)) {
                document.getElementById('updateOddsResponse').textContent = 'Error: All odds and line fields must be filled with valid numbers.';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/update-odds`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });
                
                const data = await response.json();
                document.getElementById('updateOddsResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('updateOddsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('addLiquidityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('liquidityMarketAddress').value;
            const amount = document.getElementById('liquidityAmount').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/add-liquidity`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: parseFloat(amount)
                    }),
                });
                
                const data = await response.json();
                document.getElementById('addLiquidityResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('addLiquidityResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('placeBetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('betMarketAddress').value;
            const amount = document.getElementById('betAmount').value;
            const betType = document.getElementById('betType').value;
            const betSide = document.getElementById('betSide').value; // e.g., 'home', 'away', 'over', 'under'
            const bettor = document.getElementById('bettor').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/place-bet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: parseFloat(amount),
                        betType, // 'moneyline', 'spread', or 'total'
                        betSide, // 'home', 'away', 'over', or 'under'
                        bettor
                    }),
                });
                
                const data = await response.json();
                document.getElementById('placeBetResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('placeBetResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('setResultForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('resultMarketAddress').value;
            const homeScore = document.getElementById('homeScore').value;
            const awayScore = document.getElementById('awayScore').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/game-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'set-result',
                        homeScore: parseInt(homeScore),
                        awayScore: parseInt(awayScore)
                    }),
                });
                
                const data = await response.json();
                document.getElementById('setResultResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('setResultResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('startGameForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('startGameMarketAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/game-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'start'
                    }),
                });
                
                const data = await response.json();
                document.getElementById('startGameResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('startGameResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getUserBetsBtn').addEventListener('click', async () => {
            const marketAddress = document.getElementById('userBetsMarketAddress').value;
            const bettor = document.getElementById('userBetsBettor').value;
            
            if (!marketAddress || !bettor) {
                document.getElementById('userBetsResponse').textContent = 'Error: Market Address and Bettor Address are required.';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}/bets/${bettor}`);
                const data = await response.json();
                console.log({data});
                // Format the response for better readability
                let formattedResponse = `Bets for ${bettor} on market ${marketAddress}:\n\n`;
                if (Array.isArray(data) && data.length > 0) {
                    data.forEach(bet => {
                        formattedResponse += `Bet ID: ${bet.betId}\n`;
                        formattedResponse += `  Type: ${bet.betType} (${bet.side} ${bet.line !== 'N/A' ? bet.line : ''})\n`;
                        formattedResponse += `  Amount: ${bet.amount} USDX\n`;
                        formattedResponse += `  Odds: ${bet.odds}\n`;
                        formattedResponse += `  Potential Winnings: ${bet.potentialWinnings} USDX\n`;
                        formattedResponse += `  Settled: ${bet.settled} ${bet.settled ? (bet.won ? '(Won)' : '(Lost)') : ''}\n`;
                        formattedResponse += `---\n`;
                    });
                } else if (data.error) {
                    formattedResponse = `Error fetching bets: ${data.error} ${data.details ? '- ' + data.details : ''}`;
                } else {
                    formattedResponse += 'No bets found for this user on this market.';
                }
                document.getElementById('userBetsResponse').textContent = formattedResponse;
            } catch (error) {
                document.getElementById('userBetsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getMarketsBtn').addEventListener('click', async () => {
            try {
                const response = await fetch(`${API_URL}/api/markets`);
                const data = await response.json();
                document.getElementById('getMarketsResponse').textContent = JSON.stringify(data, null, 2);
                
                // If markets returned, auto-fill the first market address
                if (Array.isArray(data) && data.length > 0) {
                    document.getElementById('marketAddress').value = data[0].address;
                    document.getElementById('liquidityMarketAddress').value = data[0].address;
                    document.getElementById('getMarketAddress').value = data[0].address;
                    document.getElementById('betMarketAddress').value = data[0].address;
                    document.getElementById('resultMarketAddress').value = data[0].address;
                    document.getElementById('startGameMarketAddress').value = data[0].address;
                    document.getElementById('userBetsMarketAddress').value = data[0].address;
                }
            } catch (error) {
                document.getElementById('getMarketsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getLiquidityPoolBtn').addEventListener('click', async () => {
            try {
                const response = await fetch(`${API_URL}/api/liquidity-pool`);
                const data = await response.json();
                document.getElementById('getLiquidityPoolResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('getLiquidityPoolResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getMarketInfoBtn').addEventListener('click', async () => {
            const marketAddress = document.getElementById('getMarketAddress').value;
            
            if (!marketAddress) {
                document.getElementById('getMarketInfoResponse').textContent = 'Error: Market Address is required.';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/market/${marketAddress}`);
                const data = await response.json();
                
                // Format the response
                let formattedInfo = `Market Info for ${marketAddress}:\n\n`;
                if (data.error) {
                    formattedInfo = `Error fetching market info: ${data.error} ${data.details ? '- ' + data.details : ''}`;
                } else {
                    formattedInfo += `Teams: ${data.homeTeam} vs ${data.awayTeam}\n`;
                    formattedInfo += `Timestamp: ${new Date(data.gameTimestamp * 1000).toLocaleString()}\n`;
                    formattedInfo += `Status: ${data.status}\n`;
                    formattedInfo += `Settled: ${data.resultSettled} ${data.resultSettled ? `(Score: ${data.homeScore}-${data.awayScore})` : ''}\n`;
                    formattedInfo += `Odds API ID: ${data.oddsApiId}\n`;
                    formattedInfo += `---\nOdds:\n`;
                    formattedInfo += `  Moneyline: Home ${data.homeOdds} | Away ${data.awayOdds}${data.drawOdds && data.drawOdds > 0 ? ` | Draw ${data.drawOdds}` : ''}\n`;
                    formattedInfo += `  Spread: Home ${data.homeSpreadPoints} (${data.homeSpreadOdds}) | Away ${data.homeSpreadPoints.startsWith('-') ? '+' : '-'}${data.homeSpreadPoints.substring(1)} (${data.awaySpreadOdds})\n`;
                    formattedInfo += `  Total: Over ${data.totalPoints} (${data.overOdds}) | Under ${data.totalPoints} (${data.underOdds})\n`;
                    formattedInfo += `---\nExposure:\n`;
                    formattedInfo += `  Max: ${data.maxExposure} USDX\n`;
                // Update other forms with this market address
                document.getElementById('marketAddress').value = marketAddress;
                document.getElementById('liquidityMarketAddress').value = marketAddress;
                document.getElementById('betMarketAddress').value = marketAddress;
                document.getElementById('resultMarketAddress').value = marketAddress;
                document.getElementById('startGameMarketAddress').value = marketAddress;
                document.getElementById('userBetsMarketAddress').value = marketAddress;
                document.getElementById('approveMarketAddress').value = marketAddress;
            } }
            catch (error) {
                document.getElementById('getMarketInfoResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        // USDX Faucet
        document.getElementById('faucetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const address = document.getElementById('faucetAddress').value;
            const amount = document.getElementById('faucetAmount').value;
            
            try {
                const response = await fetch(`${API_URL}/api/faucet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address,
                        amount: parseFloat(amount)
                    }),
                });
                
                const data = await response.json();
                document.getElementById('faucetResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('faucetResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        // Approve USDX Spending
        document.getElementById('approveForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const marketAddress = document.getElementById('approveMarketAddress').value;
            const address = document.getElementById('approveAddress').value;
            const unlimited = document.getElementById('unlimitedApproval').checked;
            
            try {
                const response = await fetch(`${API_URL}/api/approve/${marketAddress}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address,
                        unlimited
                    }),
                });
                
                const data = await response.json();
                document.getElementById('approveResponse').textContent = JSON.stringify(data, null, 2);
                
                if (data.transaction) {
                    updateTxHash(data.transaction);
                }
            } catch (error) {
                document.getElementById('approveResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        document.getElementById('getTxDetailsBtn').addEventListener('click', async () => {
            const txHash = document.getElementById('txHash').value;
            
            try {
                const response = await fetch(`${API_URL}/api/tx/${txHash}`);
                const data = await response.json();
                document.getElementById('txDetailsResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('txDetailsResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        // Check Balance
        document.getElementById('getBalanceBtn').addEventListener('click', async () => {
            const address = document.getElementById('balanceAddress').value;
            
            try {
                const response = await fetch(`${API_URL}/api/balance/${address}`);
                const data = await response.json();
                document.getElementById('balanceResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('balanceResponse').textContent = `Error: ${error.message}`;
            }
        });
        
        // Helper function to update transaction hash field
        const updateTxHash = (hash) => {
            if (hash) {
                document.getElementById('txHash').value = hash;
            }
        };
        
        // Auto-fill timestamps with a value 24 hours in the future
        document.getElementById('gameTimestamp').value = Math.floor(Date.now() / 1000) + 86400;
        
        // Pre-fill Hardhat default addresses for convenience during local testing
        document.getElementById('oddsProviderAddress').value = '0x70997970C51812dc3A010C7d01b50e0d17dc79C8';
        document.getElementById('resultsProviderAddress').value = '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC';
        
        // Pre-fill odds API ID 
        document.getElementById('oddsApiId').value = 'NBA_2023_LAL_BOS';
        
        // Pre-fill liquidity amount
        document.getElementById('liquidityAmount').value = '10000';
        
        // Pre-fill bet amount
        document.getElementById('betAmount').value = '100';

        // Pre-fill some odds examples
        document.getElementById('homeOdds').value = '1850';
        document.getElementById('awayOdds').value = '2000';
        document.getElementById('homeSpreadPoints').value = '-75'; // -7.5
        document.getElementById('homeSpreadOdds').value = '1910';
        document.getElementById('awaySpreadOdds').value = '1910';
        document.getElementById('totalPoints').value = '2105'; // 210.5
        document.getElementById('overOdds').value = '1910';
        document.getElementById('underOdds').value = '1910';
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>